<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <!-- Navbar ami desktopon jo meretu -->
    <section id="">
        <img id="hero-bg" src="./grafika/1-bg-svg.svg" alt="">
        <nav class="navbar roboto-roboto">

            <a id="navlogolink" href="./index.html">
                <div class="nav-ossz"><img src="./grafika/logo-svg.svg" alt="logo" class="nav-logo"> <span
                        class="nav-logo-txt">GymCompass</span></div>
            </a>
            <div class="menu-icon" onclick="toggleNavHidden(menu)">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#F6F4F4">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <path d="M5 7H19" stroke="#F6F4F4" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round">
                        </path>
                        <path d="M5 12L19 12" stroke="#F6F4F4" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                        <path d="M5 17L19 17" stroke="#F6F4F4" stroke-width="3" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                    </g>
                </svg>
            </div>
            <div class="nav-links">
                <section class="nav-section ">
                    <a href="./edzotermek.html">Edzőtermek</a>
                    <a href="./kapcsolat.html">Kapcsolat</a>
                    <a href="./rolunk.html">Rólunk</a>





                </section>
                <section>
                    <a href="./registracio.html"><svg viewBox="0 0 24 24" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path
                                    d="M12.12 12.78C12.05 12.77 11.96 12.77 11.88 12.78C10.12 12.72 8.71997 11.28 8.71997 9.50998C8.71997 7.69998 10.18 6.22998 12 6.22998C13.81 6.22998 15.28 7.69998 15.28 9.50998C15.27 11.28 13.88 12.72 12.12 12.78Z"
                                    stroke="#ff7517" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                                <path
                                    d="M18.74 19.3801C16.96 21.0101 14.6 22.0001 12 22.0001C9.40001 22.0001 7.04001 21.0101 5.26001 19.3801C5.36001 18.4401 5.96001 17.5201 7.03001 16.8001C9.77001 14.9801 14.25 14.9801 16.97 16.8001C18.04 17.5201 18.64 18.4401 18.74 19.3801Z"
                                    stroke="#ff7517" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                                <path
                                    d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
                                    stroke="#ff7517" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                </path>
                            </g>
                        </svg></a>

                </section>



    </section>
    </nav>

    <!-- Nav ami mobilon jo-->
    <section class="nav-section-mobile nav-hidden" id="nav-section-mobile">
        <ul class="nav-links-mobile">
            <li><a href="./edzotermek.html">Edzőtermek</a></li>
            <li><a href="./kapcsolat.html">Kapcsolat</a></li>
            <li><a href="./rolunk.html">Rólunk</a></li>
            <li><a href="./registracio.html"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <path
                                d="M12.12 12.78C12.05 12.77 11.96 12.77 11.88 12.78C10.12 12.72 8.71997 11.28 8.71997 9.50998C8.71997 7.69998 10.18 6.22998 12 6.22998C13.81 6.22998 15.28 7.69998 15.28 9.50998C15.27 11.28 13.88 12.72 12.12 12.78Z"
                                stroke="#ff7517" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            </path>
                            <path
                                d="M18.74 19.3801C16.96 21.0101 14.6 22.0001 12 22.0001C9.40001 22.0001 7.04001 21.0101 5.26001 19.3801C5.36001 18.4401 5.96001 17.5201 7.03001 16.8001C9.77001 14.9801 14.25 14.9801 16.97 16.8001C18.04 17.5201 18.64 18.4401 18.74 19.3801Z"
                                stroke="#ff7517" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            </path>
                            <path
                                d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z"
                                stroke="#ff7517" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            </path>
                        </g>
                    </svg></a></li>


        </ul>
    </section>

    <!-- Main Content -->
    <main class="gym-detail-container">



        <section class="images-section">
            <div class="container">

                <div class="main-image-container">
                    <img id="mainImage" src="./grafika/placeholderimg.jpg" alt="Edzőterem" class="main-image">
                </div>
                <div class="image-gallery" id="imageGallery">


                </div>
                <section class="gym-name-section">

                    <h1 id="gymName" class="gym-name">Edzőterem neve</h1>

                </section>
            </div>

        </section>




        <section class="info-section">
            <div class="container">
                <div class="info-grid">

                    <div class="info-column">
                        <h3 class="info-title pricing-title">Szolgáltatások:</h3>
                        <ul id="servicesList" class="services-list">

                        </ul>
                    </div>


                    <div class="info-column">
                        <h3 class="info-title pricing-title">Árazás:</h3>
                        <ul id="pricingList" class="pricing-list">

                        </ul>
                    </div>

                    <div class="info-column">
                        <h3 class="info-title pricing-title">Nyitvatartás:</h3>
                        <ul id="openingHours" class="pricing-list"></ul>
                    </div>

                    <div class="info-column">
                        <h3 class="info-title pricing-title">Kapcsolat:</h3>
                        <div class="contact-info">
                            <p><strong>Cím:</strong> <span id="gymAddress"></span></p>
                            <p><strong>Kapcsolattartó:</strong> <span id="contactName"></span></p>
                            <p><strong>Email:</strong> <a id="contactEmail" href=""></a></p>
                            <p><strong>Telefon:</strong> <a id="contactPhone" href=""></a></p>
                            <div id="otherInfo" class="other-info"></div>
                        </div>
                        <h3 class="info-title pricing-title">Linkek:</h3>
                        <div id="socialLinks" class="social-links">

                        </div>
                    </div>


                    <div class="info-column" id="CommentField">

                        <p id="commentInfo"></p>
                    </div>
                    <div class="info-column">
                        <h3 class="info-title pricing-title">Értékelés:</h3>
                        <div class="ertekeles-div">
                            <h1 id="mainErtekeles">Asd</h1>
                            <h2 id="ertekelesCsillagok">asdasdasdasd</h2>
                            
                        </div>
                    </div>

                </div>
                <div class="info-column" id="ertekelesek">
                    


                </div>
            </div>
            </div>
            </div>
            </div>
        </section>




        <section class="map-section">
            <div class="container">
                <div id="map" class="map-container">
                    <iframe id="mapFrame" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy"
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </section>


        <section class="links-section" id="linksSection" style="display: none;">


        </section>



    </main>

    <section class="footer">
        <div>
            <img src="./grafika/logo-text-svg.svg.png" alt="logo">
        </div>
        <ul>
            <li><a href="./index.html">Főoldal</a></li>
            <li><a href="./kapcsolat.html">Kapcsolat</a></li>
            <li><a href="./edzotermek.html">Edzőtermek</a></li>
            <li><a href="./rolunk.html">Rólunk</a></li>
            <li><a href="./registracio.html">Regisztráció</a></li>

        </ul>
    </section>
</body>
<script>
    const menu = document.getElementById("nav-section-mobile");
    function toggleNavHidden(element) {
        element.classList.toggle("nav-hidden");
    }
    const urlParams = new URLSearchParams(window.location.search);
    const gymId = urlParams.get('id');
    const edzotermekunfiltered = [];

    for (let i = 0; i < localStorage.length + 1; i++) {
        edzotermekunfiltered.push(JSON.parse(localStorage.getItem(i)));
        console.log(JSON.parse(localStorage.getItem(i)));
    }

    const edzotermek = edzotermekunfiltered.filter(gym => gym !== null);
    let index = 1;


    const lsid = edzotermek.length - 1;

    var comments = [];

    function getCommentek() {
        for (let index = 0; index < localStorage.length+9; index++) {
            const element = localStorage[index];
            console.log(element);
            if (element) {
                var parsedComment = JSON.parse(element);
                if (parsedComment.edzoteremId == gymId) {
                    console.log("Found comment for this gym:", parsedComment);
                    comments.push(parsedComment);
                }
            }


        }
    }




    function GymKereses(id) {
        for (let i = 0; i < edzotermek.length; i++) {
            if (edzotermek[i].Edzoterem_id === id) {
                return edzotermek[i];
            }
        }
        return null;
    }




    const megtalaltGym = GymKereses(gymId);

    console.log(megtalaltGym);

    function LoadImagesGallery(images) {

        const imageGallery = document.getElementById("imageGallery");
        imageGallery.innerHTML = "";
        var index = 0;
        images.forEach(src => {

            const img = document.createElement("img");
            img.src = src;
            img.className = "gallery-image";
            img.id = index;
            img.onclick = function () {
                LoadMainImage(src);
            };
            imageGallery.appendChild(img);
            index++;
        });

    }

    LoadMainImage(megtalaltGym.Edzoterem_kepek[0]);
    function LoadMainImage(src) {
        const mainImage = document.getElementById("mainImage");
        mainImage.src = src;
    }
    LoadImagesGallery(megtalaltGym.Edzoterem_kepek);

    if (megtalaltGym.Edzoterem_kepek.length === 0) {
        LoadMainImage("./grafika/placeholderimg.jpg");
    } else {
        LoadMainImage(megtalaltGym.Edzoterem_kepek[0]);
    }
    function populateGymDetails(gym) {
        // Set gym name
        document.getElementById("gymName").textContent = gym.Edzoterem_adatok.Edzoterem_nev
        document.title = `${gym.Edzoterem_adatok.Edzoterem_nev} - GYMCOMPASS`



        // Load services
        loadServices(gym.Edzoterem_adatok.Edzoterem_szolgaltatasok)

        // Load pricing
        loadPricing(gym.Edzoterem_arazas)


        // Load contact information
        loadContactInfo(gym)

        // Load map
        loadMap(gym.Edzoterem_adatok.Edzoterem_cim)

        // Load social links
        if (gym.Edzoterem_linkek && gym.Edzoterem_linkek.length > 0) {
            loadSocialLinks(gym.Edzoterem_linkek)
        }
    }



    function loadServices(services) {
        const servicesList = document.getElementById("servicesList")
        servicesList.innerHTML = ""

        if (!services || services.length === 0) {
            servicesList.innerHTML = "<li>Nincs megadva szolgáltatás</li>"
            return
        }

        services.forEach((service) => {
            const li = document.createElement("li")
            li.textContent = service
            servicesList.appendChild(li)
        })
    }

    function loadPricing(pricing) {
        const pricingList = document.getElementById("pricingList")
        pricingList.innerHTML = ""

        if (!pricing || pricing.length === 0) {
            pricingList.innerHTML = "<li>Nincs megadva árazás</li>"
            return
        }

        pricing.forEach((price) => {
            const li = document.createElement("li")
            li.innerHTML = `
            <span>${price.nev}</span>
            <span class="price">${price.ar}</span>
        `
            pricingList.appendChild(li)
        })
    }



    function loadContactInfo(gym) {

        document.getElementById("gymAddress").textContent = gym.Edzoterem_adatok.Edzoterem_cim


        document.getElementById("contactName").textContent = gym.Kapcsolattarto_adatok.Kapcsolattarto_nev

        const emailLink = document.getElementById("contactEmail")
        emailLink.textContent = gym.Kapcsolattarto_adatok.Kapcsolattarto_email
        emailLink.href = `mailto:${gym.Kapcsolattarto_adatok.Kapcsolattarto_email}`


        const phoneLink = document.getElementById("contactPhone")
        phoneLink.textContent = gym.Kapcsolattarto_adatok.Kapcsolattarto_tel
        phoneLink.href = `tel:${gym.Kapcsolattarto_adatok.Kapcsolattarto_tel}`


        const otherInfo = document.getElementById("otherInfo")
        if (gym.Edzoterem_adatok.Edzoterem_egyeb_inf) {
            otherInfo.innerHTML = `<p><strong>Egyéb információ:</strong> ${gym.Edzoterem_adatok.Edzoterem_egyeb_inf}</p>`
        }
    }

    function loadMap(address) {
        const mapFrame = document.getElementById("mapFrame")
        const encodedAddress = encodeURIComponent(address)
        mapFrame.src = `https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=${encodedAddress}`


        mapFrame.src = `https://maps.google.com/maps?q=${encodedAddress}&output=embed`
    }

    function loadSocialLinks(links) {
        const linksSection = document.getElementById("linksSection")
        const socialLinks = document.getElementById("socialLinks")

        linksSection.style.display = "block"
        socialLinks.innerHTML = ""

        links.forEach((link) => {
            const a = document.createElement("a")
            a.href = link.url
            a.textContent = link.nev
            a.className = "social-link"
            a.target = "_blank"
            a.rel = "noopener noreferrer"
            socialLinks.appendChild(a)
        })
    }
    populateGymDetails(megtalaltGym);


    function LoadImages(element) {
        const nyitvatartás = document.createElement('div');
        nyitvatartás.textContent = "Nyitvatartás";
        nyitvatartás.className = 'section-title';
        const nyitvatartasList = document.createElement('ul');
        nyitvatartasList.id = 'nyitvatartasList';
        nyitvatartasList.className = 'pricing-list';
        nyitvatartasList.style.listStyleType = "none";

        let hetfo = "<li>" + (element.Edzoterem_nyitvatartas.Hetfo.Nyitas === "Nincs nyitva"
            ? "Hétfő: Zárva"
            : "Hétfő: " + element.Edzoterem_nyitvatartas.Hetfo.Nyitas + " - " + element.Edzoterem_nyitvatartas.Hetfo.Zaras) + "</li>";

        let kedd = "<li>" + (element.Edzoterem_nyitvatartas.Kedd.Nyitas === "Nincs nyitva"
            ? "Kedd: Zárva"
            : "Kedd: " + element.Edzoterem_nyitvatartas.Kedd.Nyitas + " - " + element.Edzoterem_nyitvatartas.Kedd.Zaras) + "</li>";

        let szerda = "<li>" + (element.Edzoterem_nyitvatartas.Szerda.Nyitas === "Nincs nyitva"
            ? "Szerda: Zárva"
            : "Szerda: " + element.Edzoterem_nyitvatartas.Szerda.Nyitas + " - " + element.Edzoterem_nyitvatartas.Szerda.Zaras) + "</li>";

        let csutortok = "<li>" + (element.Edzoterem_nyitvatartas.Csutortok.Nyitas === "Nincs nyitva"
            ? "Csütörtök: Zárva"
            : "Csütörtök: " + element.Edzoterem_nyitvatartas.Csutortok.Nyitas + " - " + element.Edzoterem_nyitvatartas.Csutortok.Zaras) + "</li>";

        let pentek = "<li>" + (element.Edzoterem_nyitvatartas.Pentek.Nyitas === "Nincs nyitva"
            ? "Péntek: Zárva"
            : "Péntek: " + element.Edzoterem_nyitvatartas.Pentek.Nyitas + " - " + element.Edzoterem_nyitvatartas.Pentek.Zaras) + "</li>";

        let szombat = "<li>" + (element.Edzoterem_nyitvatartas.Szombat.Nyitas === "Nincs nyitva"
            ? "Szombat: Zárva"
            : "Szombat: " + element.Edzoterem_nyitvatartas.Szombat.Nyitas + " - " + element.Edzoterem_nyitvatartas.Szombat.Zaras) + "</li>";

        let vasarnap = "<li>" + (element.Edzoterem_nyitvatartas.Vasarnap.Nyitas === "Nincs nyitva"
            ? "Vasárnap: Zárva"
            : "Vasárnap: " + element.Edzoterem_nyitvatartas.Vasarnap.Nyitas + " - " + element.Edzoterem_nyitvatartas.Vasarnap.Zaras) + "</li>";


        nyitvatartasList.innerHTML = hetfo + kedd + szerda + csutortok + pentek + szombat + vasarnap;
        const openingHoursDiv = document.getElementById("openingHours")
        openingHoursDiv.appendChild(nyitvatartasList);
        console.log(nyitvatartasList);

    }

    var rateValue = 0;

    function SetRateingValue(value) {
        rateValue = value || 0;
    }
    let date = new Date();
    const commentSection = document.getElementById("CommentField");
    const commentsKey = "" + gymId + "_comments_" + date.getTime();

    function CreateComment() {

        let date = new Date();
        const comment_date = date.getFullYear() + "." + String(date.getMonth() + 1).padStart(2, '0') + "." + String(date.getDate()).padStart(2, '0');
        const comment_username = user.username;
        const comment_user_fullname = user.fullname;
        if (rateValue === 0 || document.getElementById("commentText").value.trim() === "") {
            let commentAlertMessage = document.getElementById("commentAlertMessage");
            commentAlertMessage.textContent = "Kérlek írj, válassz értékelést.";
        } else {
            const newComment = {
                edzoteremId: gymId,
                username: comment_username,
                fullname: comment_user_fullname,
                date: comment_date,
                rating: rateValue,
                text: document.getElementById("commentText").value.trim()

            }



            console.log("New Comment:", newComment);
            localStorage.setItem(localStorage.length+1, JSON.stringify(newComment));

            commentAlertMessage.textContent = "Értékelés sikeresen elküldve.";
        }
    }

    LoadImages(megtalaltGym);

    const user = JSON.parse(localStorage.getItem("logged_in_user")) || null;

    function WriteComment(user) {
        const commentInfo = document.getElementById("commentInfo");
        if (user !== null) {

            console.log("User is logged in:", user);

            const loggedInUsername = user.username;
            const loggedInFullname = user.fullname;
            const loggedInInitial = loggedInFullname.charAt(0).toUpperCase();
            commentSection.innerHTML = '<h3 class="info-title pricing-title">Értékelés írása:</h3><p id="commentInfo"></p><div class="comment-form"><div class="comment_user_datas"><h1 class="avatar">' + loggedInInitial + '</h1><h3 class="comment_user_name">' + loggedInUsername + '</h3></div><input placeholder="Értékelés:" type="text" id="commentText"><div class="rating rating2"><a onclick="SetRateingValue(5)" href="#5" title="Give 5 stars">★</a><a onclick="SetRateingValue(4)" href="#4" title="Give 4 stars">★</a><a onclick="SetRateingValue(3)" href="#3" title="Give 3 stars">★</a><a onclick="SetRateingValue(2)" href="#2" title="Give 2 stars">★</a><a onclick="SetRateingValue(1)" href="#1" title="Give 1 star">★</a></div><p id="commentAlertMessage"></p><button onclick="CreateComment()" class="btn-submit">Küldés</button></div></div>';
        } else {
            console.log("Nincs bejelentkezett user");
            commentInfo.textContent = "Az értékelés íráshoz be kell jelentkeznie";
        }
    }



    WriteComment(user);



    getCommentek();

    function ertekelesOsszegzes() {
        let osszeg = 0;
        comments.forEach(comment => {
            osszeg += comment.rating;
        });
        const avgertekeles = osszeg / comments.length;
        const mainErtekeles = document.getElementById("mainErtekeles");
        mainErtekeles.textContent = avgertekeles.toFixed(2) + "/5";
        const ertekelesCsillagok = document.getElementById("ertekelesCsillagok");
        if (mainErtekeles <= 1.5) {
            ertekelesCsillagok.textContent = "★☆☆☆☆";
        } else if (avgertekeles > 1.5 && avgertekeles <= 2.5) {
            ertekelesCsillagok.textContent = "★★☆☆☆";
        } else if (avgertekeles > 2.5 && avgertekeles <= 3.5) {
            ertekelesCsillagok.textContent = "★★★☆☆";
        } else if (avgertekeles > 3.5 && avgertekeles <= 4.5) {
            ertekelesCsillagok.textContent = "★★★★☆";
        } else {
            ertekelesCsillagok.textContent = "★★★★★";
        }
    }

    ertekelesOsszegzes();


    function displayCommentek() {
        if (comments.length < 1) {
            const ertekelesekDiv = document.getElementById("ertekelesek");
            ertekelesekDiv.textContent = "Nincs még értékelés "
        }
        comments.forEach(element => {
            console.log(element);
            const elementDate = element.date;
            const elementUsername = element.username;
            const elementFullname = element.fullname;
            const elementRating = element.rating;
            const elementText = element.text;
            const commentInitial = elementFullname.charAt(0).toUpperCase();
            const ertekelesekDiv = document.getElementById("ertekelesek");
            ertekelesekDiv.innerHTML += `
            <div class="rating-card">
                        <div class="profile">
                            <div class="avatar">${commentInitial}</div>
                            <span class="name">${elementUsername}</span>
                            <div class="date">${elementDate}</div>
                        </div>
                        
                        <div class="label">${elementText}</div>
                        <div class="stars">
                            ${'★'.repeat(elementRating)}${'☆'.repeat(5 - elementRating)}
                        </div>
                    </div>
            `;

        });
    }

    displayCommentek();

</script>

</html>